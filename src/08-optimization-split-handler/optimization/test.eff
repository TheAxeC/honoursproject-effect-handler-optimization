"----------------------------------------------------------------";;
"Declarations of the effect and handler";;

effect EffectExample : unit -> int

effect EffectExampleOther : unit -> int

;;

let functionExample () = 1 + #EffectExample ()

;;

let handlerExampleNoVal = handler
	| #EffectExample () k -> k 2
  | val x -> x + 0

let handlerExample = handler
	| #EffectExample () k -> k 2 + k 2
  | val x -> x + 4

let handlerExampleValue = handler
  | #EffectExample () k -> k 2 + k 2
  | val x -> x + 3 + 4

let handlerExampleNested = handler
  | #EffectExample () k -> k 2 + k 2
  | val x -> with handlerExampleNoVal handle (x + functionExample () + 4)


;;

"----------------------------------------------------------------";;
"Tests";;
"The first two are equivalent";;

(* with handlerExample handle (functionExample () + 3)

;;

with handlerExampleValue handle (functionExample ())

;;

"doesnt work";; *)
let a = with handlerExample handle (functionExample () + functionExample ())

;;
(*
with handlerExampleNested handle (functionExample ())

;;

with handlerExample handle (#EffectExample () + #EffectExample () + 1)

;;

with handlerExample handle (#EffectExample () + 1 + #EffectExample ()) *)
